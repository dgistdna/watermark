<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNA 워터마크 생성기기</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="center-container">
        <h2>DNA 워터마크 생성기</h2>
        <input type="file" id="imageInput" multiple accept="image/*">
        <button onclick="processImages()">워터마크 추가</button>
        <button id="downloadAll" style="display:none;" onclick="downloadAll()">전체 다운로드</button>
        <div id="progressContainer"><div id="progressBar"></div></div>
    </div>
    <div id="preview"></div>
    
    <script>
        let watermark = new Image();
        watermark.src = 'watermark.png';  // Sample watermark image
        watermark.onload = () => console.log("Watermark loaded");

        let processedImages = [];

        function processImages() {
            const files = document.getElementById('imageInput').files;
            const preview = document.getElementById('preview');
            const progressBar = document.getElementById('progressBar');
            const progressContainer = document.getElementById('progressContainer');
            const downloadAllBtn = document.getElementById('downloadAll');
            preview.innerHTML = '';
            processedImages = [];
            
            if (files.length === 0) return;
            progressContainer.style.display = 'block';
            progressBar.style.width = '0%';
            
            let processed = 0;
            const total = files.length;
            
            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        
                        ctx.drawImage(img, 0, 0);
                        
                        const wmWidth = img.width / 5;
                        const wmHeight = (watermark.height / watermark.width) * wmWidth;
                        const margin = img.width * 0.02; // 2% margin
                        const x = img.width - wmWidth - margin;
                        const y = img.height - wmHeight - margin;
                        
                        ctx.globalAlpha = 0.5;
                        ctx.drawImage(watermark, x, y, wmWidth, wmHeight);
                        ctx.globalAlpha = 1;
                        
                        const resultImg = new Image();
                        resultImg.src = canvas.toDataURL('image/png');
                        processedImages.push(resultImg.src);
                        
                        const container = document.createElement('div');
                        container.classList.add('image-container');
                        container.appendChild(resultImg);
                        
                        const downloadLink = document.createElement('a');
                        downloadLink.href = canvas.toDataURL('image/png');
                        downloadLink.download = 'watermarked.png';
                        downloadLink.textContent = 'Download';
                        
                        container.appendChild(downloadLink);
                        preview.appendChild(container);
                        
                        processed++;
                        progressBar.style.width = (processed / total * 100) + '%';
                        
                        if (processed === total) {
                            setTimeout(() => { progressContainer.style.display = 'none'; }, 500);
                            downloadAllBtn.style.display = 'block';
                            downloadAllBtn.style.opacity = '1'; 
                        }
                    };
                };
                reader.readAsDataURL(file);
            });
        }

        function downloadAll() {
            processedImages.forEach((dataUrl, index) => {
                const link = document.createElement('a');
                link.href = dataUrl;
                link.download = `watermarked_${index + 1}.png`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            });
        }
    </script>
</body>
</html>
